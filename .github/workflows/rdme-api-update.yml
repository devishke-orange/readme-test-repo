name: ReadMe API Update

on:
  push:
    branches:
      - main

jobs:
  update-api:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repo ðŸ“š
        uses: actions/checkout@v3

      - name: Install dependencies âœ…
        run: |
          sudo apt install jq
          npm install -g rdme

      - name: Extract unique tags from JSON
        run: |
          cat orangehrm-v2.json | jq .paths[][]?.tags[] | uniq | sort > tag-list.txt

      - name: Update APIs for Admin module
        run: |
          cat tag-list.txt | grep Admin/ | sed 's/"/--tag "/' | tr '\n' ' ' | sed '1s/^/rdme openapi:reduce --out reduced.json /' > reduce-command.sh
          chmod +x reduce-command.sh
          ./reduce-command.sh
          sed -i 's/OrangeHRM Open Source : REST API v2 docs/Admin/' reduced.json
          rdme openapi reduced.json --key=${{ secrets.README_API_KEY }} --id=64d0718293b2de000be27fec
          rm reduced.json reduce-command.sh

      - name: Update APIs for Attendance module
        run: |
          cat tag-list.txt | grep Attendance/ | sed 's/"/--tag "/' | tr '\n' ' ' | sed '1s/^/rdme openapi:reduce --out reduced.json /' > reduce-command.sh
          chmod +x reduce-command.sh
          ./reduce-command.sh
          sed -i 's/OrangeHRM Open Source : REST API v2 docs/Attendance/' reduced.json
          rdme openapi reduced.json --key=${{ secrets.README_API_KEY }} --id=64d071b7d9dad80042b406e2
          rm reduced.json reduce-command.sh

      - name: Update APIs for Buzz module
        run: |
          cat tag-list.txt | grep Buzz/ | sed 's/"/--tag "/' | tr '\n' ' ' | sed '1s/^/rdme openapi:reduce --out reduced.json /' > reduce-command.sh
          chmod +x reduce-command.sh
          ./reduce-command.sh
          sed -i 's/OrangeHRM Open Source : REST API v2 docs/Buzz/' reduced.json
          rdme openapi reduced.json --key=${{ secrets.README_API_KEY }} --id=64d37433e56ecd0044c50411
          rm reduced.json reduce-command.sh

      - name: Update APIs for Claim module
        run: |
          cat tag-list.txt | grep Claim/ | sed 's/"/--tag "/' | tr '\n' ' ' | sed '1s/^/rdme openapi:reduce --out reduced.json /' > reduce-command.sh
          chmod +x reduce-command.sh
          ./reduce-command.sh
          sed -i 's/OrangeHRM Open Source : REST API v2 docs/Claim/' reduced.json
          rdme openapi reduced.json --key=${{ secrets.README_API_KEY }} --id=64d34fac219add006fb85ddf
          rm reduced.json reduce-command.sh

      - name: Update APIs for Core module
        run: |
          cat tag-list.txt | grep Core/ | sed 's/"/--tag "/' | tr '\n' ' ' | sed '1s/^/rdme openapi:reduce --out reduced.json /' > reduce-command.sh
          chmod +x reduce-command.sh
          ./reduce-command.sh
          sed -i 's/OrangeHRM Open Source : REST API v2 docs/Core/' reduced.json
          rdme openapi reduced.json --key=${{ secrets.README_API_KEY }} --id=64d351a98ad34c0043486fc0
          rm reduced.json reduce-command.sh

      - name: Update APIs for Dashboard module
        run: |
          cat tag-list.txt | grep Dashboard | sed 's/"/--tag "/' | tr '\n' ' ' | sed '1s/^/rdme openapi:reduce --out reduced.json /' > reduce-command.sh
          chmod +x reduce-command.sh
          ./reduce-command.sh
          sed -i 's/OrangeHRM Open Source : REST API v2 docs/Dashboard/' reduced.json
          rdme openapi reduced.json --key=${{ secrets.README_API_KEY }} --id=64d351524e3c8d000a411789
          rm reduced.json reduce-command.sh

      - name: Update APIs for Directory module
        run: |
          cat tag-list.txt | grep Directory | sed 's/"/--tag "/' | tr '\n' ' ' | sed '1s/^/rdme openapi:reduce --out reduced.json /' > reduce-command.sh
          chmod +x reduce-command.sh
          ./reduce-command.sh
          sed -i 's/OrangeHRM Open Source : REST API v2 docs/Directory/' reduced.json
          rdme openapi reduced.json --key=${{ secrets.README_API_KEY }} --id=64d352152562d6000b83bd17
          rm reduced.json reduce-command.sh

      - name: Update APIs for Leave module
        run: |
          cat tag-list.txt | grep Leave/ | sed 's/"/--tag "/' | tr '\n' ' ' | sed '1s/^/rdme openapi:reduce --out reduced.json /' > reduce-command.sh
          chmod +x reduce-command.sh
          ./reduce-command.sh
          sed -i 's/OrangeHRM Open Source : REST API v2 docs/Leave/' reduced.json
          rdme openapi reduced.json --key=${{ secrets.README_API_KEY }} --id=64d3527e811982002554958d
          rm reduced.json reduce-command.sh

      - name: Update APIs for Maintenance module
        run: |
          cat tag-list.txt | grep Maintenance/ | sed 's/"/--tag "/' | tr '\n' ' ' | sed '1s/^/rdme openapi:reduce --out reduced.json /' > reduce-command.sh
          chmod +x reduce-command.sh
          ./reduce-command.sh
          sed -i 's/OrangeHRM Open Source : REST API v2 docs/Maintenance/' reduced.json
          rdme openapi reduced.json --key=${{ secrets.README_API_KEY }} --id=64d352e9c0f6af000d397d66
          rm reduced.json reduce-command.sh

      - name: Update APIs for Mobile module
        run: |
          cat tag-list.txt | grep Mobile/ | sed 's/"/--tag "/' | tr '\n' ' ' | sed '1s/^/rdme openapi:reduce --out reduced.json /' > reduce-command.sh
          chmod +x reduce-command.sh
          ./reduce-command.sh
          sed -i 's/OrangeHRM Open Source : REST API v2 docs/Mobile/' reduced.json
          rdme openapi reduced.json --key=${{ secrets.README_API_KEY }} --id=64d353262d555d00476044b1
          rm reduced.json reduce-command.sh

      - name: Update APIs for OAuth module
        run: |
          cat tag-list.txt | grep OAuth/ | sed 's/"/--tag "/' | tr '\n' ' ' | sed '1s/^/rdme openapi:reduce --out reduced.json /' > reduce-command.sh
          chmod +x reduce-command.sh
          ./reduce-command.sh
          sed -i 's/OrangeHRM Open Source : REST API v2 docs/OAuth/' reduced.json
          rdme openapi reduced.json --key=${{ secrets.README_API_KEY }} --id=64d3537a3f0374004964d7e3
          rm reduced.json reduce-command.sh

      - name: Update APIs for Performance module
        run: |
          cat tag-list.txt | grep Performance/ | sed 's/"/--tag "/' | tr '\n' ' ' | sed '1s/^/rdme openapi:reduce --out reduced.json /' > reduce-command.sh
          chmod +x reduce-command.sh
          ./reduce-command.sh
          sed -i 's/OrangeHRM Open Source : REST API v2 docs/Performance/' reduced.json
          rdme openapi reduced.json --key=${{ secrets.README_API_KEY }} --id=64d353c38119820025549f3b
          rm reduced.json reduce-command.sh

      - name: Update APIs for Pim module
        run: |
          cat tag-list.txt | grep Pim/ | sed 's/"/--tag "/' | tr '\n' ' ' | sed '1s/^/rdme openapi:reduce --out reduced.json /' > reduce-command.sh
          chmod +x reduce-command.sh
          ./reduce-command.sh
          sed -i 's/OrangeHRM Open Source : REST API v2 docs/Pim/' reduced.json
          rdme openapi reduced.json --key=${{ secrets.README_API_KEY }} --id=64d3541ae56ecd0044c30229
          rm reduced.json reduce-command.sh

      - name: Update APIs for Recruitment module
        run: |
          cat tag-list.txt | grep Recruitment/ | sed 's/"/--tag "/' | tr '\n' ' ' | sed '1s/^/rdme openapi:reduce --out reduced.json /' > reduce-command.sh
          chmod +x reduce-command.sh
          ./reduce-command.sh
          sed -i 's/OrangeHRM Open Source : REST API v2 docs/Recruitment/' reduced.json
          rdme openapi reduced.json --key=${{ secrets.README_API_KEY }} --id=64d3545ddbc9a60039f43351
          rm reduced.json reduce-command.sh

      - name: Update APIs for Time module
        run: |
          cat tag-list.txt | grep Time/ | sed 's/"/--tag "/' | tr '\n' ' ' | sed '1s/^/rdme openapi:reduce --out reduced.json /' > reduce-command.sh
          chmod +x reduce-command.sh
          ./reduce-command.sh
          sed -i 's/OrangeHRM Open Source : REST API v2 docs/Time/' reduced.json
          rdme openapi reduced.json --key=${{ secrets.README_API_KEY }} --id=64d3548a2949020023b81a39
          rm reduced.json reduce-command.sh