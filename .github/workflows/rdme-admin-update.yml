name: Admin API Update

on:
  push:
    branches:
      - main

jobs:
  rdme-openapi:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repo ðŸ“š
        uses: actions/checkout@v3

      - name: Install dependencies
        run: |
          sudo apt install jq
          npm install -g rdme

      - name: Reduce orangehrm-v2.json
        run: |
          cat orangehrm-v2.json | jq .paths[][]?.tags[] | sed 's/"/--tag "/' | grep Admin/ | uniq |tr '\n' ' ' | sed '1s/^/rdme openapi:reduce --out admin.json /' > admin-command.sh
          chmod +x admin-command.sh
          ./admin-command.sh

      - name: Run `openapi` command ðŸš€
        run: rdme openapi admin.json --key=${{ secrets.README_API_KEY }} --id=64d0718293b2de000be27fec
