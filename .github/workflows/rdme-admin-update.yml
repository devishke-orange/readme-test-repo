name: ReadMe API Update

on:
  push:
    branches:
      - main

jobs:
  update-api:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repo ðŸ“š
        uses: actions/checkout@v3

      - name: Install dependencies âœ…
        run: |
          sudo apt install jq
          npm install -g rdme

      - name: Extract unique tags from JSON
        run: |
          cat orangehrm-v2.json | jq .paths[][]?.tags[] | uniq | sort > tag-list.txt

      - name: Update APIs for Admin module
        run: |
          cat tag-list.txt | grep Admin/ | sed 's/"/--tag "/' | tr '\n' ' ' | sed '1s/^/rdme openapi:reduce --out reduced.json /' > reduce-command.sh
          chmod +x reduce-command.sh
          ./reduce-command.sh
          sed -i 's/OrangeHRM Open Source : REST API v2 docs/Admin/' reduced.json
          rdme openapi reduced.json --key=${{ secrets.README_API_KEY }} --id=64d0718293b2de000be27fec
          rm reduced.json reduce-command.sh

      - name: Update APIs for Attendance module
        run: |
          cat tag-list.txt | grep Admin/ | sed 's/"/--tag "/' | tr '\n' ' ' | sed '1s/^/rdme openapi:reduce --out reduced.json /' > reduce-command.sh
          chmod +x reduce-command.sh
          ./reduce-command.sh
          sed -i 's/OrangeHRM Open Source : REST API v2 docs/Attendance/' reduced.json
          rdme openapi reduced.json --key=${{ secrets.README_API_KEY }} --id=64d071b7d9dad80042b406e2
          rm reduced.json reduce-command.sh